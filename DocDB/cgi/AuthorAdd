#! /usr/bin/env perl
#
# Author Eric Vaandering (ewv@fnal.gov)
#

use CGI;
use DBI;

require "DocDBGlobals.pm";
require "ResponseElements.pm";
require "SecuritySQL.pm";
require "Security.pm";
require "HTMLUtilities.pm";

$query = new CGI;  # Global for subroutines
$dbh   = DBI->connect('DBI:mysql:'.$db_name.':'.$db_host,$db_rwuser,$db_rwpass);

&GetSecurityGroups;

%params = $query -> Vars;

print $query -> header;
&BTeVHeader("Author Addition Results");

print "<p><h3>Here are the results of your attempt to add an author
                to the BTeV document database:</h3><p>\n";

@error_stack = ();

unless (&CanCreate()) {
  push @error_stack,"You are not allowed to add authors to the DocDB.";
}

$InstitutionID     = $params{inst};
$FirstName = $params{first};
$MiddleInitials  = $params{middle};
$LastName = $params{lastname};
  
if (@error_stack) {
  &EndPage(@error_stack);
}

my $AuthorInsert = $dbh->prepare(
   "insert into Author ".
          "(AuthorID, FirstName, MiddleInitials, LastName, InstitutionID,Active) ". 
   "values (0,        ?,         ?,              ?,        ?,            1)");
            
$AuthorInsert -> execute($FirstName,$MiddleInitials,$LastName,$InstitutionID);
my $AuthorID = $AuthorInsert -> {mysql_insertid}; # Works with MySQL only
                           
if ($AuthorID) {
  print "You were successful. $FirstName $MiddleInitials $LastName has been
         added as an author.<br>\n"; 
} else {
  print "Something went wrong. Make sure you did everything right. If the
         problem still exists, contact an administrator.\n"; 
}

&DocDBNavBar("Add&nbsp;Author",$AuthorAddForm);
&BTeVFooter($DBWebMasterEmail,$DBWebMasterName);

